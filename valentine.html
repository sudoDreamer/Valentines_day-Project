<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will You Be My Valentine? â¤ï¸</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Pacifico&display=swap" rel="stylesheet">
</head>
<body class="proposal-page">
    <div class="floating-hearts"></div>
    
    <div class="proposal-container">
        <div class="proposal-card">
            <div class="proposal-emoji">ğŸ’</div>
            <h1 class="proposal-question" id="proposalQuestion">
                Will you be my Valentine?
            </h1>
            <p class="proposal-subtitle" id="proposalSubtitle">
                I have something special to ask you...
            </p>

            <div class="button-container">
                <button class="btn-yes" id="yesBtn">
                    YES! ğŸ’•
                </button>
                <button class="btn-no" id="noBtn">
                    No
                </button>
            </div>

            <p class="no-message" id="noMessage"></p>
        </div>
    </div>

    <!-- Heart explosion container -->
    <div class="hearts-explosion" id="heartsExplosion"></div>

    <script>
        // Decode URL parameters
        function getDataFromURL() {
            const params = new URLSearchParams(window.location.search);
            const encodedData = params.get('data');
            
            if (!encodedData) {
                return {
                    n: 'Beautiful',
                    m: 'You mean the world to me!',
                    i: ''
                };
            }

            try {
                const jsonString = atob(decodeURIComponent(encodedData));
                return JSON.parse(jsonString);
            } catch (e) {
                console.error('Error decoding data:', e);
                return {
                    n: 'Beautiful',
                    m: 'You mean the world to me!',
                    i: ''
                };
            }
        }

        // Personalize the page
        const data = getDataFromURL();
        document.getElementById('proposalQuestion').textContent = 
            `Will you be my Valentine, ${data.n}?`;

        // NO button logic
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const noMessage = document.getElementById('noMessage');
        let noClickCount = 0;
        let yesScale = 1;

        // Initialize NO button position so it sits anywhere on-screen (fixed)
        // but always stays outside the white proposal card boundary.
        window.addEventListener('load', () => {
            // place initially and ensure it's outside the card
            placeNoButtonOutsideCard();
        });

        const noMessages = [
            "Are you sure? ğŸ¥º",
            "Please reconsider! ğŸ’”",
            "Don't break my heart! ğŸ˜¢",
            "Think about it again! ğŸ™",
            "I believe in us! âœ¨",
            "One more chance? ğŸ’"
        ];

        // Place NO button somewhere in the viewport that does NOT overlap the
        // white proposal card. Uses fixed positioning so it never causes page scroll.
        function placeNoButtonOutsideCard() {
            const card = document.querySelector('.proposal-card');
            const cardRect = card.getBoundingClientRect();
            const btnRect = noBtn.getBoundingClientRect();
            const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
            const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);

            const margin = 12; // keep some gap from edges

            function isOverlappingCard(x, y) {
                // compute button rect at candidate x/y (top-left)
                const left = x;
                const top = y;
                const right = x + btnRect.width;
                const bottom = y + btnRect.height;

                return !(right < cardRect.left || left > cardRect.right || bottom < cardRect.top || top > cardRect.bottom);
            }

            // Try random positions until we find one outside the card
            let attempts = 0;
            let x, y;
            do {
                x = Math.floor(margin + Math.random() * (vw - btnRect.width - margin * 2));
                y = Math.floor(margin + Math.random() * (vh - btnRect.height - margin * 2));
                attempts++;
                // safety fallback after some attempts
                if (attempts > 50) break;
            } while (isOverlappingCard(x, y));

            // Apply fixed position
            noBtn.style.position = 'fixed';
            noBtn.style.left = x + 'px';
            noBtn.style.top = y + 'px';
            noBtn.style.transform = 'none';
        }

        // move on pointer events, always picking a new spot outside the card
        function moveNoButton() {
            placeNoButtonOutsideCard();

            // Grow YES button
            yesScale += 0.07;
            yesBtn.style.transform = `scale(${yesScale})`;

            // Show message
            if (noClickCount < noMessages.length) {
                noMessage.textContent = noMessages[noClickCount];
                noClickCount++;
            }
        }

        // NO button events
        noBtn.addEventListener('mouseenter', moveNoButton);
        noBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            moveNoButton();
        });
        noBtn.addEventListener('click', (e) => {
            e.preventDefault();
            moveNoButton();
        });

        // YES button logic
        yesBtn.addEventListener('click', () => {
            yesBtn.disabled = true;
            noBtn.disabled = true;
            
            // Create heart explosion
            createHeartExplosion();

            // Redirect after animation
            setTimeout(() => {
                const currentURL = new URLSearchParams(window.location.search);
                const dataParam = currentURL.get('data');
                window.location.href = `love.html?data=${dataParam || ''}`;
            }, 2000);
        });

        // Heart explosion animation
        function createHeartExplosion() {
            const container = document.getElementById('heartsExplosion');
            const heartSymbols = ['â¤ï¸', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’', 'ğŸ’˜'];
            
            for (let i = 0; i < 30; i++) {
                const heart = document.createElement('div');
                heart.className = 'explosion-heart';
                heart.textContent = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
                
                // Random angle
                const angle = (Math.PI * 2 * i) / 30;
                const velocity = 100 + Math.random() * 100;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                heart.style.setProperty('--tx', `${tx}px`);
                heart.style.setProperty('--ty', `${ty}px`);
                
                container.appendChild(heart);
                
                // Remove after animation
                setTimeout(() => heart.remove(), 2000);
            }
        }

        // Add floating hearts background
        function createFloatingHearts() {
            const container = document.querySelector('.floating-hearts');
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = 'â¤ï¸';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 5 + 's';
                heart.style.fontSize = (Math.random() * 20 + 10) + 'px';
                container.appendChild(heart);
            }
        }

        createFloatingHearts();
    </script>
</body>
</html>